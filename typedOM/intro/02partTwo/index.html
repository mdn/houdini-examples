<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
  <title>Part 2 Methods | Typed OM</title>
  <meta name="description" content="Demonstration for Mozilla Developer Network using Typed OM.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="../../../sharedAssets/shared-styles.css">
  <link rel="stylesheet" href="style.css">

  <style type="text/css">

  </style>

</head>
<body>

<header>
	<h2>CSS Houdini Collection</h2>
	<h1>Typed OM: Part 2 StyleMaps & Methods</h1>
</header>

<article class="houdini-demo typed-om">

	<button class="example">Click Me</button>

<!-- describe readonly here -->
	<p>The <code>computedStyleMap</code> introduced in the previous section, is of type <code>StylePropertyMapReadOnly</code>. This is a map-like object, and so supports all the iterable methods like <code>forEach()</code>, <code>keys()</code>, <code>values()</code>, and <code>entries()</code> â€” making it intuitive to work with<sup>1</sup>.

	<p>It also comes with the following methods: <code>get()</code>, <code>getAll()</code> and <code>has()</code>, as well as a <code>size</code> property.</p>

	<p>Let's use our button example to try these methods:</p>

	<pre class="language-js"><code>// get the button element
const buttonEl = document.querySelector('.example');

// let's get some styles -> we can retrieve all computed styles with `computedStyleMap`
const allComputedStyles = buttonEl.computedStyleMap();

// StylePropertyMapReadOnly
// iterable methods ==================
// keys returns an iterable list of properties
const props = allComputedStyles.keys();
console.log(props.next().value); // returns align-content

// values returns an iterable list of the css values
const vals = allComputedStyles.values();
console.log(vals.next().value); // returns a CSSStyleValue

// entries returns an iterable of the items
const iterableStyles = allComputedStyles.entries();
console.log(iterableStyles.next().value); // returns a two item array with align-content as the first item and CSSStyleValue as the second

// forEach will allow us to run code over each prop/val pair
allComputedStyles.forEach((elem, index, arr) => {
// oode to run for each pair
})

// interface methods ========================
// let's get the value for padding-top
const padTop = allComputedStyles.get('padding-top');
console.log(padTop); // logs a CSSUnitValue

const allPadTop = allComputedStyles.getAll('padding-top');
console.log(allPadTop); // logs an array with one item: A CSSUnitValue

const hasPadTop = allComputedStyles.has('padding-top');
console.log(hasPadTop); // logs true

const amountStyles = allComputedStyles.size;
console.log(amountStyles); // logs 338</code></pre>

	<p>So far we've been working with <code>computedStyleMap</code>, which returns all the properties and values affecting an element, but there is also the <code>attributeStyleMap</code> for getting and setting inline styles. This is much like our already commonly used <code>style()</code> method, and you might wonder why we need to change something that works. With this new Typed OM method we also work with all the <code>CSSStyleValue</code> types, rather than just strings. This makes our code far more robust and flexible. (We'll look at the different <code>CSSStyleValue</code> types in the next section).</p>

	<p>Let's take a look at the methods available to us when using the <code>attributeStyleMap</code>. <code>attributeStyleMap</code> is of type <code>StylePropertyMap</code> which inherits from the above <code>StylePropertyMapReadOnly</code>, this means we have access to all the methods above, but also a few extras: <code>set()</code>, <code>append()</code>, <code>delete()</code> and <code>clear()</code>.</p>

<pre class="language-js"><code>// set padding-top on button style attribute
buttonEl.attributeStyleMap.set('padding-top', CSS.px(10));

// set background-image on button style attribute
buttonEl.attributeStyleMap.set('background-image', 'linear-gradient(90deg, white, black');

// append another value to the background-image property set on the attribute
buttonEl.attributeStyleMap.append('background-image', 'linear-gradient(180deg, blue, black');

// remove background-image from style attribute
buttonEl.attributeStyleMap.delete('background-image');

// clear all styles from the style attribute
buttonEl.attributeStyleMap.clear();
</code></pre>

	<p>A couple of things to note here: When we are setting the pixel value we are creating a <code>CSSUnitValue</code> using the <code>CSS.px()</code> factory method. We could have set it thus:</p>

	<pre class="language-js"><code>new CSSUnitValue(10, px);</code></pre>

	<p>We'll be looking at different <code>CSSStyleValue</code> in the next sections.</p>

	<p>As well as attribute styles we can also access stylesheet rules via the <code>styleMap</code> attribute available on a <code>CSSStyleRule</code> (basically the stylesheets).</p>

	<pre class="language-js"><code>const stylesheet = document.styleSheets[0];

Object.values(stylesheet.cssRules).forEach(block => {

	if (block.selectorText === 'button') {
		console.log(block.cssText);
	}
})
// Logs css block: button { --unit: 1.2rem; --mainColour: hsl(198, 100%, 66%); display: inline-block; padding: var(--unit) calc(var(--unit)*2); ...}
</code></pre>

	<p>The methods already discussed are available to us and we can modify or update any of these properties like so:</p>

<pre class="language-js"><code>if (block.selectorText === 'button') {
	block.styleMap.set('--mainColour', 'black');
}
</code></pre>

	<p>Might be worth noting this should be used with caution, as it's a pretty powerful way to update your styles.</p>

	<p>Next <a href="/typedOM/intro/03partThree">let's take a look at different value types which are now available with Typed OM.</a></p>

	<!-- <p>Well done! You've covered all the basics of using Typed OM. There's quite a bit there and with all the values quite a bit still to think about (all the math sums for instance) There's <a href="../../reference/">a reference with resources here</a> and loads more information in the MDN docs.</p> -->

	<!-- <p>There's <a href="">more examples here</a> of using Typed OM in practice.</p> -->

	<p><sup>1</sup>https://developers.google.com/web/updates/2018/03/cssom</p>
</article>

<footer>
	<p>Examples created by <a href="https://developer.mozilla.org/en-US/profiles/Rumyra">Rumyra</a> for MDN Docs: <a href="https://wiki.developer.mozilla.org/en-US/docs/Web/API/CSS_Typed_OM_API">See full documentation here</a> </p>
</footer>

<script src="../../../sharedAssets/prism.js"></script>
<script src="app.js"></script>

</body>
</html>
